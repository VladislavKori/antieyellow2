import{a as y,u as b,r as l,q as w,s as A,j as t,b as e,F as N,A as x,I as O,B as S,C,D as H,R as k,g as E,M as I,E as V}from"./index-864a135d.js";import{A as R}from"./AdminMenu-89a6688f.js";import{I as F}from"./ImageViewer-6bea9138.js";function T(){const r=y(a=>a.galary),o=b(),d=new FormData,i=l.useRef(null),[m,_]=l.useState(!1),[f,g]=l.useState(!1),[h,u]=l.useState(""),c=a=>{a.preventDefault(),_(!0)},p=a=>{a.preventDefault(),_(!1)},v=a=>{a.preventDefault(),i.current=[...a.dataTransfer.files][0],g(!0),_(!1)},D=()=>{if(i.current==null||h=="")return!1;d.append("title",h),d.append("img",i.current),o(C({data:d}))};return l.useEffect(()=>{r.error?(alert(r.error),o(w())):o(A())},[r.error,o]),t("div",{className:"addphoto",children:[e("div",{onDragStart:a=>c(a),onDragLeave:a=>p(a),onDragOver:a=>c(a),onDrop:a=>v(a),className:m?"addphoto__upload addphoto__upload_active":"addphoto__upload",children:f?e(N,{children:e("h1",{style:{color:"white"},children:"Файл загружен"})}):t("div",{className:"addphoto__upload-inside",children:[e(x,{}),t("p",{className:"addphoto__upload-text",children:["Перетащите картинку сюда или ",e("span",{className:"addphoto__upload-text_yellow",children:"загрузите"})]})]})}),t("div",{className:"addphoto__content",children:[e(O,{lable:"Название",placeholder:"Введите название",type:"text",setValue:u,value:h}),e(S,{onClick:D,children:"Добавить фотографию"})]})]})}function $({photoid:r}){const o=y(n=>n.galary),d=b(),i=new FormData,m=l.useRef(null),[_,f]=l.useState(!1),[g,h]=l.useState(!1),[u,c]=l.useState("");l.useEffect(()=>{o.photos&&c(o.photos[r].title)},[o.photos]);const p=n=>{n.preventDefault(),f(!0)},v=n=>{n.preventDefault(),f(!1)},D=n=>{n.preventDefault(),m.current=[...n.dataTransfer.files][0],h(!0),f(!1)},a=()=>{if(m.current==null||u=="")return console.log("hello");i.append("title",u),i.append("img",m.current),i.append("photoid",o.photos[r].id),d(H({data:i}))};return l.useEffect(()=>{o.error?(alert(o.error),d(w())):d(A())},[o.error,d]),t("div",{className:"addphoto",children:[e("div",{onDragStart:n=>p(n),onDragLeave:n=>v(n),onDragOver:n=>p(n),onDrop:n=>D(n),className:_?"addphoto__upload addphoto__upload_active":"addphoto__upload",children:g?e(N,{children:e("h1",{style:{color:"white"},children:"Файл загружен"})}):t("div",{className:"addphoto__upload-inside",children:[e(x,{}),t("p",{className:"addphoto__upload-text",children:["Перетащите картинку сюда или ",e("span",{className:"addphoto__upload-text_yellow",children:"загрузите"})]})]})}),t("div",{className:"addphoto__content",children:[e(O,{lable:"Название",placeholder:"Введите название",type:"text",setValue:c,value:u}),e(S,{onClick:a,children:"Изменить фотографию"})]})]})}function j(){const[r,o]=l.useState(),d=(s,P)=>{P?(o(null),document.body.style.overflow="auto"):o(s)},[i,m]=l.useState(!1),[_,f]=l.useState(!1),[g,h]=l.useState(!1),u=b(),c=y(s=>s.galary),[p,v]=l.useState(0);l.useEffect(()=>{c&&u(w()),u(A())},[]);const D=()=>{p!=null&&u(V({photoid:p}))},a=s=>{v(s),h(!0)},n=s=>{v(s),m(!0)};return t(N,{children:[t("div",{className:"ag",children:[e("h1",{className:"admin__title",children:"Галерея"}),t("div",{className:"admin__content",children:[e("h2",{className:"ag__min-title",children:"Список добавленных фотографий"}),e("ul",{className:"admin__list",children:c.photos?e(N,{children:c.photos.map((s,P)=>t(k.Fragment,{children:[t("li",{className:"ag__item admin__item",children:[t("div",{className:"ag__info",children:[e("div",{style:{background:`url('${E.SERVER_HOST+"/"+s.path}')`,backgroundSize:"cover",backgroundPosition:"center"},className:"ag__preview",onClick:()=>d(s.id,!1)}),t("div",{className:"ag__text-info",children:[e("h1",{className:"ag__item-title",children:s.title}),t("p",{className:"ag__item-text",children:["ID: ",s.id]}),t("p",{className:"ag__item-text",children:["Дата публикации: ",s.createdAt]})]})]}),t("div",{className:"ag__manage",children:[e(S,{onClick:()=>a(s.id),type:"delete",children:e(N,{})}),e(S,{type:"change",onClick:()=>n(P),children:e(N,{})})]})]}),r===s.id?e(F,{photoHandler:d,isOpen:r,item:s}):null]},P))}):e("h2",{children:"Фотографий нет"})})]}),e(S,{onClick:()=>f(!0),children:"Добавить фотографию"})]}),_?e(I,{setVisible:f,currentState:_,children:e(T,{})}):null,i?e(I,{setVisible:m,currentState:i,children:e($,{photoid:p})}):null,g&&p!=null&&c.photos?e(I,{setVisible:h,currentState:g,children:t("div",{className:"admin__delwindow",children:[t("p",{className:"admin__deltext",children:["Вы уверены, что хотите удалить картину “","”?"]}),t("div",{className:"admin__delbtns",children:[e("button",{className:"admin__delbtn",onClick:D,children:"Удалить"}),e("button",{className:"admin__cancelbtn",onClick:()=>h(!1),children:"Отмена"})]})]})}):null]})}function G(){const r=y(o=>o.auth);return!r.userInfo&&r.loading?e("h1",{children:"Loading"}):r.isAdmin?t("div",{className:"admin",children:[e("div",{className:"admin__main-area",children:e(j,{})}),e(R,{})]}):e("h1",{children:"Вы не админ, доступ запрещён"})}export{G as default};
